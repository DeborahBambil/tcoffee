machine:
    services:
        - docker
dependencies:
  pre:
    - mkdir ~/repo 
    - docker pull cbcrg/holy-tcoffee-build-box:1.1
  cache_directories:
    - ~/repo
  override:
    - mkdir $HOME/publish
    - docker run -v $HOME/tcoffee:/root/tcoffee -v $HOME/repo:/root/repo -v $HOME/publish:/publish cbcrg/holy-tcoffee-build-box:1.1 tcoffee/build/build.sh env tcoffee doc_test; mv /root/sandbox /publish
    -  chown -R $(id -u):$(id -g) ~/repo /publish
test: 
  override:
    - rsync -avzr -e "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" $HOME/publish/sandbox/distributions/* ec2-user@tcoffee.org:~/Dropbox/Public/public_html/Packages/CircleCI/ 
    - rsync -avz -e "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" $HOME/publish/sandbox/test-results/index.html ec2-user@tcoffee.org:~/Dropbox/Public/public_html/Packages/CircleCI/tests/test-results-linux-x64-$(date +"%Y-%m-%d").html
                  
            
